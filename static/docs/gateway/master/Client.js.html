<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Client.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Client.html">Client</a><ul class='methods'><li data-type='method'><a href="Client.html#fetchGateway">fetchGateway</a></li><li data-type='method'><a href="Client.html#spawn">spawn</a></li></ul></li><li><a href="Connection.html">Connection</a><ul class='methods'><li data-type='method'><a href="Connection.html#connect">connect</a></li><li data-type='method'><a href="Connection.html#disconnect">disconnect</a></li><li data-type='method'><a href="Connection.html#heartbeat">heartbeat</a></li><li data-type='method'><a href="Connection.html#receive">receive</a></li><li data-type='method'><a href="Connection.html#reconnect">reconnect</a></li><li data-type='method'><a href="Connection.html#resume">resume</a></li><li data-type='method'><a href="Connection.html#send">send</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">Client.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Connection_1 = require("./Connection");
const https = require("https");
const events_1 = require("events");
/**
 * Information about connecting to the Discord gateway.
 * @typedef Gateway
 * @type {object}
 * @prop {string} url The URL of the gateway
 * @prop {number} shards The shard count to use
 */
/**
 * @typedef WSOptions
 * @type {object}
 * @prop {?boolean} reconnect Whether to automatically attempt to reconnect
 */
/**
 * Manages connections to the gateway.
 */
class Client extends events_1.EventEmitter {
    /**
     * @constructor
     * @param {Client} client The client of this manager
     * @param {WSOptions} [options={}] Connection options
     */
    constructor(token, options = {}) {
        super();
        this.token = token;
        /**
         * Whether to attempt to automatically reconnect; if false, an error event will be emitted on the client.
         * @type {boolean}
         */
        this.reconnect = options.reconnect === undefined ? true : options.reconnect;
        /**
         * Current connections to the gateway.
         * @type {Connection[]}
         * @readonly
         */
        this.connections = new Map();
        /**
         * Information about the gateway.
         * @type {Gateway}
         */
        this.gateway = undefined;
    }
    /**
     * Fetch the gateway info.
     * @param {boolean} [force={}] Whether to override any previous cache
     */
    async fetchGateway(force = false) {
        if (this.gateway &amp;&amp; !force)
            return this.gateway;
        return this.gateway = await new Promise((resolve, reject) => {
            https.get({
                host: 'discordapp.com',
                path: '/api/v6/gateway/bot',
                headers: {
                    Authorization: `Bot ${this.token}`,
                },
            }, (res) => {
                if (res.statusCode !== 200)
                    return reject(res);
                let data = '';
                res
                    .setEncoding('utf8')
                    .on('data', chunk => data += chunk)
                    .once('end', () => {
                    try {
                        return resolve(JSON.parse(data));
                    }
                    catch (e) {
                        return reject(e);
                    }
                })
                    .once('error', reject);
            });
        });
    }
    /**
     * Spawn shards.
     * @param {number|number[]} [shards=this.gateway.shards] The shards to spawn
     */
    async spawn(shards) {
        const gateway = await this.fetchGateway();
        if (shards === undefined)
            shards = gateway.shards;
        if (typeof shards === 'number') {
            const count = shards;
            shards = Array(shards);
            for (let i = 0; i &lt; count; i++)
                shards[i] = i;
        }
        await Promise.all(shards.map(shard => {
            const conn = new Connection_1.default(this, shard);
            this.connections.set(shard, conn);
            return conn.connect();
        }));
    }
}
exports.default = Client;

//# sourceMappingURL=Client.js.map
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sat Feb 10 2018 12:49:26 GMT-0600 (Central Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>

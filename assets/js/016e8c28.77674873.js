"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[741],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=r,h=d["".concat(s,".").concat(m)]||d[m]||u[m]||i;return n?a.createElement(h,o(o({ref:t},c),{},{components:n})):a.createElement(h,o({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2285:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return u}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),o=["components"],l={id:"proxy",title:"Proxy"},s="Proxy",p={unversionedId:"applications/proxy",id:"applications/proxy",title:"Proxy",description:"The Spectacles proxy is responsible for handling all of the data interactions with Discord.",source:"@site/docs/applications/proxy.md",sourceDirName:"applications",slug:"/applications/proxy",permalink:"/docs/applications/proxy",draft:!1,editUrl:"https://github.com/spec-tacles/website/edit/master/website/docs/applications/proxy.md",tags:[],version:"current",frontMatter:{id:"proxy",title:"Proxy"},sidebar:"docs",previous:{title:"Gateway",permalink:"/docs/applications/gateway"},next:{title:"JavaScript",permalink:"/docs/libraries/js"}},c={},u=[{value:"Usage",id:"usage",level:2},{value:"Timeout",id:"timeout",level:3},{value:"Request Format",id:"request-format",level:3},{value:"Response Format",id:"response-format",level:3},{value:"Response Status",id:"response-status",level:4},{value:"Response Body",id:"response-body",level:4}],d={toc:u};function m(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"proxy"},"Proxy"),(0,i.kt)("p",null,"The Spectacles proxy is responsible for handling all of the data interactions with Discord."),(0,i.kt)("ul",{className:"contains-task-list"},(0,i.kt)("li",{parentName:"ul",className:"task-list-item"},(0,i.kt)("input",{parentName:"li",type:"checkbox",checked:!0,disabled:!0})," ","Ratelimited REST calls to Discord"),(0,i.kt)("li",{parentName:"ul",className:"task-list-item"},(0,i.kt)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","Caching REST responses"),(0,i.kt)("li",{parentName:"ul",className:"task-list-item"},(0,i.kt)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","Caching ingested data from the ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/spec-tacles/gateway"},"gateway"))),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("p",null,"The proxy communicates with other services using the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/spec-tacles/spec"},"Spectacles spec")," over Redis."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"JS: ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/spec-tacles/spectacles.js"},(0,i.kt)("inlineCode",{parentName:"a"},"spectacles.js"))),(0,i.kt)("li",{parentName:"ul"},"C#: ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/spec-tacles/Spectacles.NET"},(0,i.kt)("inlineCode",{parentName:"a"},"Spectacles.NET"))),(0,i.kt)("li",{parentName:"ul"},"Go: ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/spec-tacles/go"},(0,i.kt)("inlineCode",{parentName:"a"},"spec-tacles/go"))),(0,i.kt)("li",{parentName:"ul"},"Rust: ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/spec-tacles/rustacles"},(0,i.kt)("inlineCode",{parentName:"a"},"rustacles")))),(0,i.kt)("p",null,"The proxy can be configured with the following options. This file must be called ",(0,i.kt)("inlineCode",{parentName:"p"},"proxy.toml")," and exist in the CWD. Alternatively, specify the values in the environment variables named adjacently. The following example contains the default values."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml"},'timeout = "" # TIMEOUT\n\n[broker]\ngroup = "gateway" # BROKER_GROUP\nevent = "REQUEST" # BROKER_EVENT\n\n[redis]\nurl = "localhost:6379" # REDIS_URL\npool_size = 32 # REDIS_POOL_SIZE\n\n[discord]\napi_version = 10 # DISCORD_API_VERSION\n\n[metrics]\n# addr = "0.0.0.0:3000" # METRICS_ADDR\n# path = "metrics" # METRICS_PATH\n')),(0,i.kt)("h3",{id:"timeout"},"Timeout"),(0,i.kt)("p",null,"The timeout is a human-readable duration (e.g. 2min). It applies for the entire duration of the request, including time paused for ratelimiting. Once the timeout occurs, the proxy will attempt to stop the request; however, it's possible for the data to be sent to Discord and the timeout to occur during the response, meaning that your client will receive the error but the request will have succeeded. This is done to protect against indefinitely hung requests in case Discord doesn't respond."),(0,i.kt)("h3",{id:"request-format"},"Request Format"),(0,i.kt)("p",null,"Requests can be made by publishing on the specified event to the specified group. The data must be serialized in MessagePack format."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "method": "GET",\n    "path": "/users/1234",\n    "query": {\n        "foo": "bar"\n    },\n    "body": [],\n    "headers": {\n        "def": "uvw"\n    }\n}\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"query"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"body"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"headers")," are optional. Body must be binary data."),(0,i.kt)("h3",{id:"response-format"},"Response Format"),(0,i.kt)("p",null,"The response is returned on the callback queue in the following MessagePack format."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "status": 0,\n    "body": ...\n}\n')),(0,i.kt)("h4",{id:"response-status"},"Response Status"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"right"},(0,i.kt)("strong",{parentName:"th"},"Status")),(0,i.kt)("th",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"th"},"Description")))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"0"),(0,i.kt)("td",{parentName:"tr",align:null},"Success")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"1"),(0,i.kt)("td",{parentName:"tr",align:null},"Unknown error")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"2"),(0,i.kt)("td",{parentName:"tr",align:null},"Invalid request format (non-JSON)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"3"),(0,i.kt)("td",{parentName:"tr",align:null},"Invalid URL path")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"4"),(0,i.kt)("td",{parentName:"tr",align:null},"Invalid URL query")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"5"),(0,i.kt)("td",{parentName:"tr",align:null},"Invalid HTTP method")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"6"),(0,i.kt)("td",{parentName:"tr",align:null},"Invalid HTTP headers")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"7"),(0,i.kt)("td",{parentName:"tr",align:null},"Request failure")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"right"},"8"),(0,i.kt)("td",{parentName:"tr",align:null},"Request timeout")))),(0,i.kt)("h4",{id:"response-body"},"Response Body"),(0,i.kt)("p",null,"For a successful call (status 0), the body will be an object representing the HTTP response:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "status": 200,\n    "headers": {\n        "foo": "bar"\n    },\n    "url": "https://discord.com/api/v6/users/4567",\n    "body": []\n}\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"url")," represents the full, final URL of the request. ",(0,i.kt)("inlineCode",{parentName:"p"},"body")," is the binary response body from the server."),(0,i.kt)("p",null,"For an unsuccessful status code (non-zero status), the body will be a string describing the error."))}m.isMDXComponent=!0}}]);
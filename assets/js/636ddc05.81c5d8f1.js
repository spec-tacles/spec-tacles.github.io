"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[463],{8255:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return s},metadata:function(){return l},toc:function(){return p},default:function(){return c}});var n=a(7462),o=a(3366),i=(a(7294),a(3905)),r=["components"],s={id:"gateway",title:"Gateway"},l={unversionedId:"gateway",id:"gateway",isDocsHomePage:!1,title:"Gateway",description:"The gateway is responsible for connecting your bot to Discord and is what will put your bot",source:"@site/docs/gateway.md",sourceDirName:".",slug:"/gateway",permalink:"/docs/gateway",editUrl:"https://github.com/spec-tacles/website/edit/master/website/docs/gateway.md",version:"current",frontMatter:{id:"gateway",title:"Gateway"},sidebar:"docs",previous:{title:"Introduction",permalink:"/docs/"},next:{title:"JavaScript",permalink:"/docs/libraries/js"}},p=[{value:"Config",id:"config",children:[{value:"Gateway event names",id:"gateway-event-names",children:[]}]},{value:"Standard IO",id:"standard-io",children:[]},{value:"AMQP",id:"amqp",children:[]},{value:"Reference",id:"reference",children:[]}],u={toc:p};function c(e){var t=e.components,a=(0,o.Z)(e,r);return(0,i.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,'The gateway is responsible for connecting your bot to Discord and is what will put your bot\n"online". The Spectacles Gateway automatically handles the complexities involved with reconnection,\nratelimiting, and sharding and outputs a continuous stream of events to your applications.'),(0,i.kt)("h2",{id:"config"},"Config"),(0,i.kt)("p",null,"The Spectacles Gateway has a variety of configuration options, but there are only 2 values that\nyou ",(0,i.kt)("em",{parentName:"p"},"must")," provide for the Gateway to work: your bot token and a list of events to publish."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml"},'token = "" # Discord token\nevents = [] # array of gateway event names to publish\n')),(0,i.kt)("p",null,"By default, the Gateway reads its config file from ",(0,i.kt)("inlineCode",{parentName:"p"},"gateway.toml")," in the current working directory.\nYou can also use environment variables in situations where that may be more convenient (e.g. when)\nrunning in a Docker Compose environment."),(0,i.kt)("p",null,"You can also specify this config using environment variables."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"DISCORD_TOKEN"),": your token"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"DISCORD_EVENTS"),": comma-separated string of gateway event names")),(0,i.kt)("h3",{id:"gateway-event-names"},"Gateway event names"),(0,i.kt)("p",null,"Gateway events are documented on the ",(0,i.kt)("a",{parentName:"p",href:"https://discord.com/developers/docs/topics/gateway#event-names"},"Discord API documentation"),"."),(0,i.kt)("h2",{id:"standard-io"},"Standard IO"),(0,i.kt)("p",null,"By default, the Gateway simply outputs to standard output. If you'd like to run a quick test,\nhere's a Docker command you can run to see incoming ",(0,i.kt)("inlineCode",{parentName:"p"},"MESSAGE_CREATE")," events."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'docker run --rm -it \\\n    --name gateway \\\n    -e DISCORD_TOKEN="your token" \\\n    -e DISCORD_EVENTS=MESSAGE_CREATE \\\n    spectacles/gateway\n')),(0,i.kt)("p",null,"You can even publish data ",(0,i.kt)("em",{parentName:"p"},"back")," to the gateway if you input JSON to the terminal."),(0,i.kt)("p",null,"This is the JSON format used when using the STDIO mode of the gateway. ",(0,i.kt)("inlineCode",{parentName:"p"},"event"),"\nis mapped to the ",(0,i.kt)("inlineCode",{parentName:"p"},"t")," property and ",(0,i.kt)("inlineCode",{parentName:"p"},"data")," is mapped to the ",(0,i.kt)("inlineCode",{parentName:"p"},"d")," property of a\n",(0,i.kt)("a",{parentName:"p",href:"https://discord.com/developers/docs/topics/gateway#payloads-gateway-payload-structure"},"Gateway packet"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "event": "",\n    "data": {}\n}\n')),(0,i.kt)("h2",{id:"amqp"},"AMQP"),(0,i.kt)("p",null,"Most of the time, you'll want to use a proper message broker for getting data from the Gateway to\nyour applications. Change your config to specify AMQP as the broker type by adding the TOML below."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-toml"},'[broker]\ntype = "amqp"\ngroup = "gateway"\nmessage_timeout = "2m"\n\n[amqp]\nurl = "amqp://localhost"\n')),(0,i.kt)("p",null,"To run a quick demonstration of the AMQP capabilities:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Setup a RabbitMQ instance")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker run --rm -it \\\n    --name rabbit \\\n    -p 5672:5672 \\\n    -p 15672:15672 \\\n    rabbitmq:3-management\n")),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},"Run the Gateway and connect it to RabbitMQ")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'docker run --rm -it \\\n    --name gateway \\\n    -e DISCORD_TOKEN="your token" \\\n    -e DISCORD_EVENTS=MESSAGE_CREATE \\\n    -e BROKER_TYPE=amqp \\\n    -e AMQP_URL=amqp://localhost:5672\n')),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},"Send a message in any guild that your bot is in"),(0,i.kt)("li",{parentName:"ol"},"View the RabbitMQ dashboard at ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:15672"},(0,i.kt)("inlineCode",{parentName:"a"},"http://localhost:15672"))),(0,i.kt)("li",{parentName:"ol"},'Navigate to "Queues" and select "gateway:MESSAGE_CREATE"'),(0,i.kt)("li",{parentName:"ol"},'Expand "Get messages"'),(0,i.kt)("li",{parentName:"ol"},'Change "Ack Mode" to "Ack message requeue false"'),(0,i.kt)("li",{parentName:"ol"},'Click "Get Message(s)"')),(0,i.kt)("p",null,"You should see JSON output in your dashboard with the contents of the Discord message you sent."),(0,i.kt)("h2",{id:"reference"},"Reference"),(0,i.kt)("p",null,"Detailed Spectacles Gateway documentation is available on ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/spec-tacles/gateway"},"GitHub"),"."))}c.isMDXComponent=!0}}]);